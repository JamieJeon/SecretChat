var sock=null,admin=!1;
$(document).ready(function(){$("#sendWord").on("click",function(){""!=$("#word").val()&&message_send("chat",$("#id").val(),$("#word").val())});$("#fileSend").on("click",function(){if(""!=$("#file").val()){var a=new FormData(document.getElementById("fileForm"));a.append("id",$("#id").val());$.ajax({url:contextPath+"/REST/IMAGE_SEND",processData:!1,contentType:!1,data:a,type:"POST",dataType:"json"}).done(function(a){a=a.BODY;message_send("img",$("#id").val(),a);document.getElementById("fileForm").reset()}).fail(function(a,c, d){console.log("\uc624\ub958\uba85: "+d);console.log("\uc0c1\ud0dc: "+c)}).always(function(a,c){console.log("done")})}});$("#connect").on("click",function(){if(""==$("#id").val())alert("Input the ID!");else{var a=!0;$.getJSON(contextPath+"/REST/GET_USERS_ID",function(b){for(var c=0;c<b.length;c++)$("#id").val()==b[c]&&(a=!1);a?(sock=new SockJS(contextPath+"/chat"),sock.onopen=onOpen,sock.onmessage=onMessage,sock.onclose=onClose,$("#disconn").hide(),$("#conn").show()):alert("\uc774\ubbf8 \ub85c\uadf8\uc778\ud55c \uc544\uc774\ub514\uc785\ub2c8\ub2e4.")})}});
$("#disconnect").on("click",function(){disconnect();$("#conn").hide();$("#disconn").show()});$("#wordList").on("change",function(){console.log("fff")})});function onOpen(a){message_send("on",$("#id").val(),"\ucc44\ud305\ubc29\uc5d0 \ub4e4\uc5b4\uc624\uc168\uc2b5\ub2c8\ub2e4.");document.getElementById("word").onfocus=!0}function onClose(a){$("#id").val("");$("#wordList").html("<h2>List Words</h2>")}
function onMessage(a){var b=JSON.parse(a.data);a=b.id;var c=b.type;b=b.message;"alert"==c?alert(b):"chat"==c?appendMessage(a+" : "+b):"img"==c?appendImage(a,b):(refreshId(),appendMessage(a+" : "+b))}function disconnect(){sock.close()}function message_send(a,b,c){if("alert"!=a||admin)a=JSON.stringify({type:a,id:b,message:c}),sock.send(a),$("#word").val("")}
function appendMessage(a){$("#wordList").append("<p>"+a+"<em> "+getTime()+"</em></p>");a=document.getElementById("wordList");a.scrollTop=a.scrollHeight}function appendImage(a,b){if(""!=b){$("#wordList").append("<p>"+a+" : <img src=/file"+b+' class="file_send_image"/><em> '+getTime()+"</em></p>");var c=document.getElementById("wordList");c.scrollTop=c.scrollHeight}}
function refreshId(){$.getJSON(contextPath+"/REST/GET_USERS_ID",function(a){$("#user_list").html("");for(var b=0;b<a.length;b++)$("#user_list").append("<p>"+a[b]+"</p>")})}function getTime(){var a=new Date,b=a.getHours();a=a.getMinutes();10>a&&(a="0"+a);var c="\uc624\uc804";12<b&&(b-=12,c="\uc624\ud6c4");return c+" "+b+":"+a};